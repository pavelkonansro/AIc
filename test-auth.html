<!DOCTYPE html>
<html>
<head>
    <title>AIc Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 400px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .result { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê∂ AIc Auth Test</h1>
        
        <div class="form-group">
            <label for="nick">–ò–º—è:</label>
            <input type="text" id="nick" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
        </div>
        
        <div class="form-group">
            <label for="age">–í–æ–∑—Ä–∞—Å—Ç:</label>
            <select id="age">
                <option value="9-12">9-12 –ª–µ—Ç</option>
                <option value="13-15" selected>13-15 –ª–µ—Ç</option>
                <option value="16-18">16-18 –ª–µ—Ç</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="country">–°—Ç—Ä–∞–Ω–∞:</label>
            <select id="country">
                <option value="CZ">–ß–µ—Ö–∏—è</option>
                <option value="DE">–ì–µ—Ä–º–∞–Ω–∏—è</option>
                <option value="US" selected>–°–®–ê</option>
            </select>
        </div>
        
        <button id="startBtn" onclick="startChat()">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
        
        <div id="result"></div>
    </div>

    <script>
        async function startChat() {
            const nick = document.getElementById('nick').value.trim();
            const age = document.getElementById('age').value;
            const country = document.getElementById('country').value;
            const resultDiv = document.getElementById('result');
            const startBtn = document.getElementById('startBtn');
            
            if (!nick) {
                showResult('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –∏–º—è', 'error');
                return;
            }
            
            startBtn.disabled = true;
            startBtn.textContent = '–°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...';
            
            try {
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userResponse = await fetch('http://localhost:3001/auth/guest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nick: nick,
                        ageGroup: age,
                        locale: getLocaleFromCountry(country)
                    })
                });
                
                if (!userResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userResponse.status}`);
                }
                
                const userData = await userResponse.json();
                const userId = userData.user.id;
                
                showResult(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${userData.user.nick} (${userData.user.ageGroup})`, 'success');
                
                startBtn.textContent = '–°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é...';
                
                // –°–æ–∑–¥–∞–µ–º —á–∞—Ç —Å–µ—Å—Å–∏—é
                const sessionResponse = await fetch('http://localhost:3001/chat/session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: userId })
                });
                
                if (!sessionResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏: ${sessionResponse.status}`);
                }
                
                const sessionData = await sessionResponse.json();
                
                showResult(`‚úÖ –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞: ${sessionData.sessionId}`, 'success');
                showResult(`üéâ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —á–∞—Ç—É: <a href="http://localhost:8080/chat">–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</a>`, 'success');
                
                startBtn.textContent = '–ì–æ—Ç–æ–≤–æ!';
                
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                startBtn.disabled = false;
                startBtn.textContent = '–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ';
            }
        }
        
        function getLocaleFromCountry(country) {
            switch (country) {
                case 'CZ': return 'cs-CZ';
                case 'DE': return 'de-DE';
                case 'US': return 'en-US';
                default: return 'en-US';
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = 'result ' + type;
        }
    </script>
</body>
</html>
